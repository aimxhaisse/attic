;; -*-lisp-*-
;;
;; s. rannou <mxs@sbrk.org>
;;
;; stumpwm's configuration file

(in-package :stumpwm)

;; border color of windows
(set-focus-color "palegreen3")
(set-unfocus-color "black")

;; start in stumpwm's package
(setf *default-package* :stumpwm)

;; be verbose
(setf *debug-level* 10)
(setf *debug-stream* (open "/tmp/mxs-stumpwm.log"
			   :direction :output
			   :if-exists :supersede))

;; click to focus
(setf *mouse-focus-policy* :click)

;; run-or-raise searches through screens and groups
(setf *run-or-raise-all-groups* t)
(setf *run-or-raise-all-screens* t)

;; groups
(grename "misc")
(mapc #'gnewbg '("sbrk" "web" "code"))

;; few quotes from futurama
(defparameter *futurama-quotes* '("IN COLOR"
				  "PROUDLY MADE ON EARTH"
				  "LIVE FROM OMICRON PERSEI 8"
				  "MADE FROM MEAT BY-PRODUCTS"
				  "NOT Y3K COMPLIANT"))

;; returns a random quote
(defun get-random-quote (quotes)
  "returns a random quote from Futurama"
  (setf *random-state* (make-random-state t))
  (nth (random (length quotes)) quotes))

;; run a program in a term
(defun run-in-term (cmd props)
  (run-or-raise (concatenate 'string "urxvt -e " cmd) props))

;; commands
(defcommand urxvt () ()
	    "urxvt"
	    (run-shell-command "urxvt"))

(defcommand conkeror () ()
	    "conkeror"
	    (gselect (find-group (current-screen) "web"))
	    (run-or-raise "conkeror" '(:instance "conkeror")))

(defcommand ncmpcpp () ()
	    "ncmpcpp"
	    (gselect (find-group (current-screen) "misc"))
 	    (run-in-term "ncmpcpp" `(:instance "ncmpcpp")))

(defcommand alsamixer () ()
	    "alsamixer"
	    (gselect (find-group (current-screen) "misc"))
 	    (run-in-term "alsamixer" `(:instance "alsamixer")))

(defcommand mutt () ()
	    "mutt"
	    (gselect (find-group (current-screen) "misc"))
 	    (run-in-term "mutt" `(:instance "mutt")))

(defcommand irssi () ()
	    "irssi"
	    (gselect (find-group (current-screen) "sbrk"))
	    ;; somehow tmux needs the TERM set to xterm, not urxvt
 	    (run-in-term "bash -c 'TERM=xterm ssh sbrk.org -t LANG=fr_FR.utf8 tmux a'" `(:instance "irssi")))

(defcommand kb-on () ()
	    "kb-on"
	    (run-shell-command "setxkbmap -variant intl")
	    (message "Accents On!"))

(defcommand kb-off () ()
	    "kb-off"
	    (run-shell-command "setxkbmap -layout us")
	    (message "Accents Off!"))

;; shortcuts
(define-key *root-map* (kbd "c") "urxvt")
(define-key *root-map* (kbd "/") "kb-on")
(define-key *root-map* (kbd "\\") "kb-off")

(kb-on)

;; we are done, let zoidberg talk
(setf *startup-message* (get-random-quote *futurama-quotes*))
